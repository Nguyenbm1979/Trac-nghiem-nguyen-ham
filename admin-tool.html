<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>C√¥ng C·ª• T·∫°o ƒê·ªÅ Thi B·∫£o M·∫≠t</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 30px; background: #f4f4f9; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        textarea { width: 100%; height: 250px; padding: 10px; margin-top: 10px; border: 1px solid #ddd; font-family: monospace; font-size: 14px; }
        button { background: #27ae60; color: white; border: none; padding: 15px 30px; font-size: 18px; font-weight: bold; cursor: pointer; display: block; margin: 20px auto; border-radius: 5px; }
        button:hover { background: #219150; }
        .note { background: #fff3cd; padding: 10px; border-left: 5px solid #ffc107; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>C√îNG C·ª§ M√É H√ìA ƒê·ªÄ THI</h1>
        
        <div class="note">
            <strong>H∆∞·ªõng d·∫´n:</strong><br>
            1. D√°n n·ªôi dung file d·ªØ li·ªáu ƒë·ªÅ thi (d·∫°ng <code>window.EXAM_DATA = ...</code>) v√†o √¥ b√™n d∆∞·ªõi.<br>
            2. B·∫•m n√∫t <strong>"M√É H√ìA NGAY"</strong>.<br>
            3. Copy k·∫øt qu·∫£ ·ªü √¥ d∆∞·ªõi c√πng v√† d√°n v√†o file <code>data/de-xx.js</code> tr√™n GitHub.
        </div>

        <h3>1. D√°n D·ªØ Li·ªáu G·ªëc (Ch∆∞a b·∫£o m·∫≠t) v√†o ƒë√¢y:</h3>
        <textarea id="inputData" placeholder="Paste code window.EXAM_DATA = {...} v√†o ƒë√¢y..."></textarea>

        <button onclick="encryptData()">üîí M√É H√ìA NGAY</button>

        <h3>2. K·∫øt Qu·∫£ (ƒê√£ b·∫£o m·∫≠t - Copy c√°i n√†y):</h3>
        <textarea id="outputData" readonly placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y..."></textarea>
    </div>

    <script>
        function hash(input) {
            // H√†m m√£ h√≥a gi·ªëng h·ªát trong file thi.html
            return CryptoJS.MD5(String(input).trim().toLowerCase()).toString();
        }

        function encryptData() {
            const raw = document.getElementById('inputData').value;
            
            // D√πng th·ªß thu·∫≠t ƒë·ªÉ bi·∫øn chu·ªói th√†nh ƒë·ªëi t∆∞·ª£ng JS
            // L∆∞u √Ω: Code n√†y ch·∫°y c·ª•c b·ªô tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n n√™n an to√†n.
            let dataObj;
            try {
                // T√°ch l·∫•y ph·∫ßn JSON b√™n trong window.EXAM_DATA = ...
                const jsonPart = raw.substring(raw.indexOf('{'), raw.lastIndexOf('}') + 1);
                // D√πng new Function ƒë·ªÉ parse (v√¨ JSON.parse kh√¥ng hi·ªÉu c√°c key kh√¥ng c√≥ ngo·∫∑c k√©p)
                const func = new Function("return " + jsonPart);
                dataObj = func();
            } catch (e) {
                alert("L·ªói c√∫ ph√°p! H√£y ch·∫Øc ch·∫Øn b·∫°n copy ƒë√∫ng format window.EXAM_DATA = { ... };");
                return;
            }

            // B·∫ÆT ƒê·∫¶U M√É H√ìA
            if(dataObj.questions) {
                dataObj.questions.forEach(q => {
                    // 1. M√£ h√≥a c√¢u MCQ
                    if(q.type === 'mcq') {
                        // ans ƒëang l√† s·ªë (v√≠ d·ª•: 1), ƒë·ªïi th√†nh m√£ h√≥a c·ªßa s·ªë ƒë√≥
                        q.ans = hash(q.ans); 
                    }
                    // 2. M√£ h√≥a c√¢u TF (ƒê√∫ng Sai)
                    else if(q.type === 'tf') {
                        q.items.forEach(item => {
                            item.ans = hash(item.ans); // 'T' -> m√£ h√≥a
                        });
                    }
                    // 3. M√£ h√≥a c√¢u Short (Tr·∫£ l·ªùi ng·∫Øn)
                    else if(q.type === 'short') {
                        q.ans = hash(q.ans); // '44.4' -> m√£ h√≥a
                    }
                });
            }

            // Xu·∫•t k·∫øt qu·∫£
            const finalString = "window.EXAM_DATA = " + JSON.stringify(dataObj, null, 4) + ";";
            document.getElementById('outputData').value = finalString;
            alert("ƒê√£ m√£ h√≥a xong! H√£y copy k·∫øt qu·∫£ ·ªü √¥ d∆∞·ªõi.");
        }
    </script>
</body>
</html>
