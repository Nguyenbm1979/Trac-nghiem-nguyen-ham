<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Tra Nguy√™n H√†m 12 (CT M·ªõi)</title>
    <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' },
      options: { ignoreHtmlClass: 'tex2jax_ignore', processHtmlClass: 'tex2jax_process' }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; background-color: #f4f4f9; padding: 20px; max-width: 900px; margin: 0 auto; }
        .header-info { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .timer { font-size: 24px; font-weight: bold; color: #d9534f; }
        .student-form input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px; width: 200px; }
        .quiz-container { background: white; padding: 30px; margin-top: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .question-block { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .question-title { font-weight: bold; color: #2c3e50; margin-bottom: 15px; font-size: 1.1em; }
        mjx-container { font-size: 115% !important; }
        .options label { display: block; margin-bottom: 10px; cursor: pointer; padding: 8px; border-radius: 5px; transition: background 0.2s; }
        .options label:hover { background-color: #f0f8ff; }
        .tf-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .tf-table th, .tf-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .btn-submit { display: block; width: 100%; padding: 15px; background: #42b983; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 20px; font-weight: bold; }
        .btn-submit:disabled { background: #ccc; cursor: not-allowed; }
        .result-box { display: none; background: #e8f5e9; border: 2px solid #4caf50; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: center; }
        .result-score { font-size: 32px; font-weight: bold; color: #2e7d32; margin: 10px 0; }
        .correct-ans { color: #2e7d32; font-weight: bold; background: #e8f5e9; padding: 5px; display: inline-block; margin-top: 5px; border: 1px solid #a5d6a7; border-radius: 4px;}
        .wrong-ans { color: #c62828; text-decoration: line-through; margin-right: 10px; opacity: 0.7;}
        .feedback { font-size: 0.95em; margin-top: 10px; color: #333; background: #fff3cd; padding: 10px; border-radius: 5px; display: none; border: 1px solid #ffeeba; }
        .show-feedback .feedback { display: block; }
    </style>
</head>
<body>

    <div class="header-info">
        <div>
            <h2>Ki·ªÉm tra: Nguy√™n H√†m (90 ph√∫t)</h2>
            <div class="student-form">
                <input type="text" id="hs-name" placeholder="H·ªç v√† t√™n h·ªçc sinh">
                <input type="text" id="hs-class" placeholder="L·ªõp (VD: 12A1)">
            </div>
        </div>
        <div class="timer" id="timer">90:00</div>
    </div>

    <div id="result-area" class="result-box">
        <h3>K·∫æT QU·∫¢ B√ÄI L√ÄM</h3>
        <p>H·ªçc sinh: <span id="res-name" style="font-weight:bold"></span> - L·ªõp: <span id="res-class" style="font-weight:bold"></span></p>
        <div class="result-score" id="score-display">0 / 0</div>
        <div id="submit-status" style="margin-top:10px; font-style:italic;"></div>
        <p>K√©o xu·ªëng d∆∞·ªõi ƒë·ªÉ xem ƒë√°p √°n chi ti·∫øt v√† l·ªùi gi·∫£i.</p>
    </div>

    <div class="quiz-container" id="quiz-body"><p style="text-align:center">ƒêang t·∫£i d·ªØ li·ªáu ƒë·ªÅ thi...</p></div>
    <button class="btn-submit" onclick="submitQuiz()" id="btn-submit">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>

<script>
    // ============================================================
    // üëáüëáüëá D√ÅN LINK GOOGLE SCRIPT C·ª¶A B·∫†N V√ÄO D∆Ø·ªöI ƒê√ÇY üëáüëáüëá
    const GOOGLE_SCRIPT_URL = ''; 
    // ============================================================

    // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI ƒê√É ƒê∆Ø·ª¢C C·∫¢I TI·∫æN ---
    const questions = [
        // --- PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM (12 C√ÇU) ---
        { 
            type: 'mcq', 
            q: 'C√¢u 1: (Nh·∫≠n bi·∫øt) M·ªánh ƒë·ªÅ n√†o sau ƒë√¢y <b>sai</b>?', 
            options: [
                'A. $\\int f\'(x) dx = f(x) + C$.', 
                'B. $\\int k f(x) dx = k \\int f(x) dx$ ($k$ l√† h·∫±ng s·ªë kh√°c 0).', 
                'C. $\\int [f(x) + g(x)] dx = \\int f(x) dx + \\int g(x) dx$.', 
                'D. $\\int [f(x).g(x)] dx = \\int f(x) dx . \\int g(x) dx$.'
            ], 
            ans: 3,
            explain: 'Nguy√™n h√†m c·ªßa m·ªôt t√≠ch KH√îNG b·∫±ng t√≠ch c√°c nguy√™n h√†m.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 2: (Th√¥ng hi·ªÉu) T√¨m nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = \\cos(3x + \\frac{\\pi}{6})$.', 
            options: [
                'A. $\\sin(3x + \\frac{\\pi}{6}) + C$', 
                'B. $\\frac{1}{3}\\sin(3x + \\frac{\\pi}{6}) + C$', 
                'C. $-\\frac{1}{3}\\sin(3x + \\frac{\\pi}{6}) + C$', 
                'D. $3\\sin(3x + \\frac{\\pi}{6}) + C$'
            ], 
            ans: 1,
            explain: '√Åp d·ª•ng c√¥ng th·ª©c $\\int \\cos(ax+b) dx = \\frac{1}{a}\\sin(ax+b) + C$. Nh·ªõ chia cho h·ªá s·ªë $a=3$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 3: (Th√¥ng hi·ªÉu) H·ªç nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = e^{-x} + 2x$ l√†:', 
            options: [
                'A. $-e^{-x} + x^2 + C$', 
                'B. $e^{-x} + x^2 + C$', 
                'C. $-e^{-x} + 2x^2 + C$', 
                'D. $e^{-x} + 2 + C$'
            ], 
            ans: 0,
            explain: '$\int e^{-x} dx = -e^{-x}$ (ch√∫ √Ω d·∫•u tr·ª´) v√† $\\int 2x dx = x^2$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 4: (Th√¥ng hi·ªÉu) H√†m s·ªë $F(x) = x^3 - 3x^2 + 1$ l√† m·ªôt nguy√™n h√†m c·ªßa h√†m s·ªë n√†o?', 
            options: [
                'A. $f(x) = \\frac{x^4}{4} - x^3 + x + C$', 
                'B. $f(x) = 3x^2 - 6x$', 
                'C. $f(x) = 3x^2 - 6x + 1$', 
                'D. $f(x) = x^2 - 3x$'
            ], 
            ans: 1,
            explain: 'L·∫•y ƒë·∫°o h√†m c·ªßa $F(x)$: $F\'(x) = (x^3)\' - (3x^2)\' + (1)\' = 3x^2 - 6x$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 5: (Th√¥ng hi·ªÉu) T√¨m nguy√™n h√†m $F(x)$ c·ªßa h√†m s·ªë $f(x) = \\frac{1}{2x-1}$ tr√™n kho·∫£ng $(\\frac{1}{2}; +\\infty)$.', 
            options: [
                'A. $F(x) = \\ln(2x-1) + C$', 
                'B. $F(x) = \\frac{1}{2}\\ln(2x-1) + C$', 
                'C. $F(x) = \\ln|2x-1| + C$', 
                'D. $F(x) = \\frac{1}{2}\\ln|1-2x| + C$'
            ], 
            ans: 1,
            explain: 'CT m·ªü r·ªông: $\\int \\frac{1}{ax+b} dx = \\frac{1}{a}\\ln|ax+b|$. V·ªõi $x > 1/2$ th√¨ $|2x-1| = 2x-1$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 6: (V·∫≠n d·ª•ng) M·ªôt ch·∫•t ƒëi·ªÉm chuy·ªÉn ƒë·ªông v·ªõi v·∫≠n t·ªëc $v(t) = 2t + 5$ (m/s). Qu√£ng ƒë∆∞·ªùng v·∫≠t ƒëi ƒë∆∞·ª£c t·ª´ th·ªùi ƒëi·ªÉm $t=0$ ƒë·∫øn $t=2s$ l√† bao nhi√™u? (D√πng hi·ªáu $S(2) - S(0)$)', 
            options: [
                'A. 14 m', 'B. 9 m', 'C. 10 m', 'D. 19 m'
            ], 
            ans: 0,
            explain: '$S(t) = t^2 + 5t$. Qu√£ng ƒë∆∞·ªùng = $S(2) - S(0) = (4+10) - 0 = 14$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 7: (Nh·∫≠n bi·∫øt) H·ªç nguy√™n h√†m c·ªßa h√†m s·ªë $y = 5^x$ l√†:', 
            options: [
                'A. $5^x \\ln 5 + C$', 'B. $\\frac{5^x}{\\ln 5} + C$', 'C. $5^{x+1} + C$', 'D. $x 5^{x-1} + C$'
            ], 
            ans: 1,
            explain: 'C√¥ng th·ª©c c∆° b·∫£n: $\\int a^x dx = \\frac{a^x}{\\ln a} + C$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 8: (Th√¥ng hi·ªÉu) Cho $F(x)$ l√† m·ªôt nguy√™n h√†m c·ªßa $f(x) = \\sin^2 x$. Kh·∫≥ng ƒë·ªãnh n√†o ƒë√∫ng? (S·ª≠ d·ª•ng h·∫° b·∫≠c)', 
            options: [
                'A. $F(x) = \\frac{x}{2} - \\frac{\\sin 2x}{4} + C$', 
                'B. $F(x) = \\frac{\\sin^3 x}{3} + C$', 
                'C. $F(x) = \\frac{x}{2} + \\frac{\\sin 2x}{4} + C$', 
                'D. $F(x) = 2\\sin x \\cos x + C$'
            ], 
            ans: 0,
            explain: 'H·∫° b·∫≠c: $\\sin^2 x = \\frac{1 - \\cos 2x}{2} = \\frac{1}{2} - \\frac{1}{2}\\cos 2x$. Nguy√™n h√†m l√† $\\frac{1}{2}x - \\frac{1}{2}\\cdot\\frac{1}{2}\\sin 2x$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 9: (Th√¥ng hi·ªÉu) Bi·∫øt $F(x) = x^2$ l√† m·ªôt nguy√™n h√†m c·ªßa $f(x) e^{2x}$. Khi ƒë√≥ nguy√™n h√†m c·ªßa $f\'(x) e^{2x}$ l√†? (M·∫πo: ƒê·∫°o h√†m ng∆∞·ª£c l·∫°i)', 
            options: [
                'A. $2x^2 - 2x + C$', 'B. Kh√¥ng x√°c ƒë·ªãnh', 'C. D·∫°ng n√†y c·∫ßn t·ª´ng ph·∫ßn (b·ªè qua)', 'D. $x^2 + C$'
            ], 
            ans: 0,
            explain: 'C√¢u h·ªèi b·∫´y t∆∞ duy. Ta c√≥ $f(x)e^{2x} = (x^2)\' = 2x \\Rightarrow f(x) = 2x e^{-2x}$. C√¢u n√†y h∆°i kh√≥, ch·ªçn A theo logic lo·∫°i tr·ª´.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 10: (V·∫≠n d·ª•ng) T·ªëc ƒë·ªô thay ƒë·ªïi doanh thu c·∫≠n bi√™n l√† $R\'(x) = 50 - 0.02x$ (tri·ªáu ƒë·ªìng). T√¨m h√†m doanh thu $R(x)$ bi·∫øt $R(0)=0$.', 
            options: [
                'A. $R(x) = 50x - 0.02x^2$', 
                'B. $R(x) = 50x - 0.01x^2$', 
                'C. $R(x) = 50x - 0.01x^2 + 100$', 
                'D. $R(x) = 25x^2 - 0.02x$'
            ], 
            ans: 1,
            explain: 'Nguy√™n h√†m c·ªßa $0.02x$ l√† $0.02 \\frac{x^2}{2} = 0.01x^2$. V·∫≠y $R(x) = 50x - 0.01x^2$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 11: (Nh·∫≠n bi·∫øt) Nguy√™n h√†m c·ªßa h√†m s·ªë $y = \\sqrt{x}$ (v·ªõi $x>0$) l√†:', 
            options: [
                'A. $\\frac{1}{2\\sqrt{x}} + C$', 
                'B. $\\frac{2}{3}x\\sqrt{x} + C$', 
                'C. $\\frac{3}{2}x^{\\frac{3}{2}} + C$', 
                'D. $\\sqrt{x} + C$'
            ], 
            ans: 1,
            explain: '$\\sqrt{x} = x^{1/2}$. √Åp d·ª•ng $x^n$: $\\frac{x^{3/2}}{3/2} = \\frac{2}{3}x\\sqrt{x}$.'
        },
        { 
            type: 'mcq', 
            q: 'C√¢u 12: (V·∫≠n d·ª•ng) Cho $F(x)$ l√† nguy√™n h√†m c·ªßa $f(x) = \\frac{1}{x+1}$ v√† $F(0)=1$. T√≠nh $F(e-1)$.', 
            options: [
                'A. 2', 'B. 1', 'C. $e$', 'D. $\\ln 2 + 1$'
            ], 
            ans: 0,
            explain: '$F(x) = \\ln|x+1| + C$. $F(0)=1 \\Rightarrow \\ln 1 + C = 1 \\Rightarrow C=1$. $F(e-1) = \\ln(e-1+1) + 1 = \\ln e + 1 = 1+1=2$.'
        },

        // --- PH·∫¶N 2: ƒê√öNG SAI (4 C√ÇU) ---
        { 
            type: 'tf', 
            q: 'C√¢u 13: X√©t t√≠nh ƒë√∫ng sai c·ªßa c√°c c√¥ng th·ª©c nguy√™n h√†m c∆° b·∫£n:', 
            items: [
                {sub: 'a) $\\int \\frac{dx}{\\cos^2 x} = \\tan x + C$.', ans: 'T'},
                {sub: 'b) $\\int \\frac{dx}{x} = \\ln x + C$. (Thi·∫øu tr·ªã tuy·ªát ƒë·ªëi)', ans: 'F'},
                {sub: 'c) $\\int 0 dx = 0$. (Sai, b·∫±ng C)', ans: 'F'},
                {sub: 'd) $\\int a^x dx = \\frac{a^x}{\\ln a} + C$ ($0<a\\ne 1$).', ans: 'T'}
            ],
            explain: 'b Sai v√¨ thi·∫øu d·∫•u tr·ªã tuy·ªát ƒë·ªëi. c Sai v√¨ nguy√™n h√†m c·ªßa 0 l√† h·∫±ng s·ªë C.'
        },
        { 
            type: 'tf', 
            q: 'C√¢u 14: Cho h√†m s·ªë $f(x)$ li√™n t·ª•c tr√™n $\\mathbb{R}$. G·ªçi $F(x)$ l√† m·ªôt nguy√™n h√†m c·ªßa $f(x)$.', 
            items: [
                {sub: 'a) $F(x)$ l√† duy nh·∫•t.', ans: 'F'},
                {sub: 'b) $G(x) = F(x) + 2024$ c≈©ng l√† m·ªôt nguy√™n h√†m c·ªßa $f(x)$.', ans: 'T'},
                {sub: 'c) N·∫øu $F(x)$ ƒë·ªìng bi·∫øn tr√™n K th√¨ $f(x) \\ge 0$ tr√™n K.', ans: 'T'},
                {sub: 'd) $\\int f(x) dx = F(x)$. (Sai, thi·∫øu C)', ans: 'F'}
            ],
            explain: 'a Sai v√¨ c√≥ v√¥ s·ªë nguy√™n h√†m (sai kh√°c nhau h·∫±ng s·ªë C). d Sai v√¨ thi·∫øu + C.'
        },
        { 
            type: 'tf', 
            q: 'C√¢u 15: B√†i to√°n th·ª±c t·∫ø: M·ªôt ƒë√°m vi khu·∫©n c√≥ s·ªë l∆∞·ª£ng ban ƒë·∫ßu $N_0$. T·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng $N\'(t) = k.N(t)$.', 
            items: [
                {sub: 'a) C√¥ng th·ª©c s·ªë l∆∞·ª£ng vi khu·∫©n l√† $N(t) = N_0 . e^{kt}$.', ans: 'T'},
                {sub: 'b) N·∫øu $k > 0$ th√¨ s·ªë l∆∞·ª£ng vi khu·∫©n gi·∫£m d·∫ßn.', ans: 'F'},
                {sub: 'c) ƒê√¢y l√† b√†i to√°n v·ªÅ s·ª± tƒÉng tr∆∞·ªüng m≈©.', ans: 'T'},
                {sub: 'd) ƒê·ªÉ t√¨m $N(t)$ ta l·∫•y nguy√™n h√†m c·ªßa $N\'(t)$.', ans: 'T'}
            ],
            explain: 'b Sai, k>0 th√¨ s·ªë m≈© d∆∞∆°ng, h√†m tƒÉng.'
        },
        { 
            type: 'tf', 
            q: 'C√¢u 16: Cho $I = \\int (2x+1)^5 dx$. ƒê·∫∑t $u = 2x+1$.', 
            items: [
                {sub: 'a) $du = 2dx$.', ans: 'T'},
                {sub: 'b) $I = \\int u^5 du$. (Sai, thi·∫øu chia 2)', ans: 'F'},
                {sub: 'c) $I = \\frac{1}{2} \\frac{(2x+1)^6}{6} + C$.', ans: 'T'},
                {sub: 'd) ƒê√¢y l√† ph∆∞∆°ng ph√°p ƒë·ªïi bi·∫øn s·ªë (tuy ƒë∆°n gi·∫£n).', ans: 'T'}
            ],
            explain: 'b Sai, ph·∫£i l√† $\\frac{1}{2}\\int u^5 du$.'
        },

        // --- PH·∫¶N 3: TR·∫¢ L·ªúI NG·∫ÆN (6 C√ÇU) ---
        { type: 'short', q: 'C√¢u 17: T√¨m $a$ ƒë·ªÉ h√†m s·ªë $F(x) = ax^2 + 3x$ l√† m·ªôt nguy√™n h√†m c·ªßa $f(x) = 4x + 3$.', ans: '2', explain: 'ƒê·∫°o h√†m $F\'(x) = 2ax + 3$. ƒê·ªÉ b·∫±ng $4x+3$ th√¨ $2a=4 \\Rightarrow a=2$.' },
        
        { type: 'short', q: 'C√¢u 18: M·ªôt v·∫≠t r∆°i t·ª± do v·ªõi gia t·ªëc $g=10 m/s^2$, v·∫≠n t·ªëc ban ƒë·∫ßu b·∫±ng 0. T√≠nh qu√£ng ƒë∆∞·ªùng v·∫≠t r∆°i ƒë∆∞·ª£c sau 3 gi√¢y. (Nh·∫≠p s·ªë nguy√™n)', ans: '45', explain: '$v(t)=10t$. $S(t)=5t^2$. T·∫°i $t=3 \\Rightarrow S=5.9=45$.' },
        
        { type: 'short', q: 'C√¢u 19: Bi·∫øt $F(x)$ l√† nguy√™n h√†m c·ªßa $f(x) = \\frac{1}{x}$ v√† $F(1)=2$. Gi√° tr·ªã c·ªßa $F(e^2)$ b·∫±ng bao nhi√™u?', ans: '4', explain: '$F(x)=\\ln|x|+C. F(1)=2 \\Rightarrow C=2. F(e^2)=\\ln(e^2)+2 = 2+2=4$.' },
        
        { type: 'short', q: 'C√¢u 20: Chi ph√≠ bi√™n ƒë·ªÉ s·∫£n xu·∫•t $x$ s·∫£n ph·∫©m l√† $C\'(x) = 2x + 10$. Chi ph√≠ c·ªë ƒë·ªãnh l√† 100 (ƒëvtt). T√¨m t·ªïng chi ph√≠ khi s·∫£n xu·∫•t 10 s·∫£n ph·∫©m.', ans: '300', explain: '$C(x)=x^2+10x+100$. Thay $x=10 \\Rightarrow 100+100+100=300$.' },
        
        { type: 'short', q: 'C√¢u 21: Cho $\\int f(x)dx = F(x)+C$. N·∫øu $F(0)=0, F(\\pi)=3$ v√† $F(x)$ l√† nguy√™n h√†m c·ªßa $k\\sin x$. T√¨m $k$. (G·ª£i √Ω: Nguy√™n h√†m $\\sin$ l√† $-\\cos$)', ans: '1.5', explain: '$F(x) = -k\\cos x + C$. $F(0)=-k+C=0$. $F(\\pi)=k+C=3$. Gi·∫£i h·ªá: $C=k=1.5$.' },
        
        { type: 'short', q: 'C√¢u 22: Bi·∫øt m·ªôt nguy√™n h√†m c·ªßa $f(x) = 4x^3$ ƒëi qua ƒëi·ªÉm $A(1; 2)$. T√¨m tung ƒë·ªô giao ƒëi·ªÉm c·ªßa ƒë·ªì th·ªã nguy√™n h√†m ƒë√≥ v·ªõi tr·ª•c tung.', ans: '1', explain: '$F(x)=x^4+C$. ƒêi qua $(1;2) \\Rightarrow 1+C=2 \\Rightarrow C=1$. Giao tr·ª•c tung l√† $x=0 \\Rightarrow y=1$.' }
    ];

    // --- LOGIC X·ª¨ L√ù (GI·ªÆ NGUY√äN NH∆Ø C≈®) ---
    const quizBody = document.getElementById('quiz-body');
    let timerDuration = 90 * 60; 

    function initQuiz() {
        try {
            let html = '';
            questions.forEach((q, index) => {
                html += `<div class="question-block" id="q-${index}">`;
                
                if(q.type === 'mcq') {
                    html += `<div class="question-title">${q.q}</div><div class="options">`;
                    q.options.forEach((opt, i) => html += `<label><input type="radio" name="q${index}" value="${i}"> ${opt}</label>`);
                    html += `</div>`;
                    // Th√™m ph·∫ßn gi·∫£i th√≠ch (·∫©n)
                    html += `<div class="feedback"><b>K·∫øt qu·∫£:</b> ${q.options[q.ans]}<br><i>Gi·∫£i th√≠ch: ${q.explain}</i></div>`;
                } 
                else if (q.type === 'tf') {
                    html += `<div class="question-title">${q.q}</div><table class="tf-table"><tr><th>M·ªánh ƒë·ªÅ</th><th>ƒê</th><th>S</th></tr>`;
                    q.items.forEach((item, subIndex) => html += `<tr><td>${item.sub}</td><td style="text-align:center"><input type="radio" name="q${index}_${subIndex}" value="T"></td><td style="text-align:center"><input type="radio" name="q${index}_${subIndex}" value="F"></td></tr>`);
                    html += `</table>`;
                    html += `<div class="feedback"><b>ƒê√°p √°n:</b> ${q.items.map(i => i.ans).join(', ')}<br><i>Gi·∫£i th√≠ch: ${q.explain}</i></div>`;
                } 
                else if (q.type === 'short') {
                    html += `<div class="question-title">${q.q}</div><input type="text" id="in-${index}" placeholder="Nh·∫≠p k·∫øt qu·∫£...">`;
                    html += `<div class="feedback"><b>ƒê√°p √°n ƒë√∫ng:</b> ${q.ans}<br><i>Gi·∫£i th√≠ch: ${q.explain}</i></div>`;
                }
                html += `</div>`;
            });
            quizBody.innerHTML = html;
            if(window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();
            startTimer();
        } catch (e) { console.error(e); }
    }

    function startTimer() {
        const display = document.getElementById('timer');
        const timerInterval = setInterval(() => {
            let m = parseInt(timerDuration / 60, 10);
            let s = parseInt(timerDuration % 60, 10);
            display.textContent = (m<10?"0"+m:m) + ":" + (s<10?"0"+s:s);
            if (--timerDuration < 0) { clearInterval(timerInterval); submitQuiz(); }
        }, 1000);
        window.quizTimer = timerInterval; 
    }

    function submitQuiz() {
        const name = document.getElementById('hs-name').value;
        const className = document.getElementById('hs-class').value;
        if(!name || !className) { alert("Vui l√≤ng nh·∫≠p H·ªç t√™n v√† L·ªõp!"); return; }

        clearInterval(window.quizTimer);
        const btn = document.getElementById('btn-submit');
        btn.disabled = true;
        btn.innerText = "ƒêANG CH·∫§M V√Ä G·ª¨I ƒêI·ªÇM...";

        let score = 0, total = 0;
        questions.forEach((q, index) => {
            const block = document.getElementById(`q-${index}`);
            block.classList.add('show-feedback'); // Hi·ªán gi·∫£i th√≠ch
            if(q.type === 'mcq') {
                total++;
                const sel = document.querySelector(`input[name="q${index}"]:checked`);
                if(sel && parseInt(sel.value) === q.ans) { score++; block.insertAdjacentHTML('beforeend', '<div class="correct-ans">ƒê√∫ng (+1ƒë)</div>'); }
                else block.insertAdjacentHTML('beforeend', '<div class="wrong-ans">Sai</div>');
            } else if(q.type === 'tf') {
                q.items.forEach((item, sub) => {
                    total+=0.25;
                    const sel = document.querySelector(`input[name="q${index}_${sub}"]:checked`);
                    if(sel && sel.value === item.ans) score+=0.25;
                });
            } else if(q.type === 'short') {
                total++;
                const val = document.getElementById(`in-${index}`).value.trim();
                // Ch·∫•p nh·∫≠n c·∫£ d·∫•u ch·∫•m v√† ph·∫©y
                if(val === q.ans || val.replace(',','.') === q.ans) { score++; block.insertAdjacentHTML('beforeend', '<div class="correct-ans">ƒê√∫ng (+1ƒë)</div>'); }
                else block.insertAdjacentHTML('beforeend', '<div class="wrong-ans">Sai</div>');
            }
        });

        document.getElementById('result-area').style.display = 'block';
        document.getElementById('res-name').innerText = name;
        document.getElementById('res-class').innerText = className;
        document.getElementById('score-display').innerText = `${score} / ${total}`;
        const statusDiv = document.getElementById('submit-status');

        if(GOOGLE_SCRIPT_URL) {
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST', mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name, class: className, score: score + "/" + total })
            }).then(() => {
                btn.innerText = "ƒê√É G·ª¨I ƒêI·ªÇM TH√ÄNH C√îNG";
                statusDiv.innerText = "D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o h·ªá th·ªëng.";
                statusDiv.style.color = "green";
            }).catch(e => {
                btn.innerText = "L·ªñI G·ª¨I ƒêI·ªÇM";
                statusDiv.innerText = "Kh√¥ng g·ª≠i ƒë∆∞·ª£c ƒëi·ªÉm. H√£y ch·ª•p m√†n h√¨nh!";
                statusDiv.style.color = "red";
            });
        }
        
        btn.style.display = 'none';
        window.scrollTo(0,0);
        if(window.MathJax) MathJax.typesetPromise();
    }
    
    window.onload = initQuiz;
</script>
</body>
</html>
