<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Nguy√™n H√†m 12</title>
    
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']], // Cho ph√©p d√πng d·∫•u $ ƒë·ªÉ k·∫πp c√¥ng th·ª©c
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; background-color: #f4f4f9; padding: 20px; max-width: 900px; margin: 0 auto; }
        .header-info { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .timer { font-size: 24px; font-weight: bold; color: #d9534f; }
        .student-form { margin-top: 15px; }
        .student-form input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px; width: 200px; }
        .quiz-container { background: white; padding: 30px; margin-top: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .question-block { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        
        /* Ch·ªânh font ch·ªØ c√¢u h·ªèi v√† c√¥ng th·ª©c to h∆°n */
        .question-title { font-weight: bold; color: #2c3e50; margin-bottom: 15px; font-size: 1.1em; }
        mjx-container { font-size: 115% !important; } /* Ph√≥ng to c√¥ng th·ª©c to√°n */

        .options label { display: block; margin-bottom: 10px; cursor: pointer; padding: 5px 0; }
        .options label:hover { background-color: #f9f9f9; }
        
        .tf-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .tf-table th, .tf-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .tf-table th { background-color: #f8f9fa; text-align: center; }
        .tf-table td.center { text-align: center; width: 60px; }
        
        .btn-submit { display: block; width: 100%; padding: 15px; background: #42b983; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin-top: 20px; font-weight: bold; }
        .btn-submit:hover { background: #3aa876; }
        
        /* K·∫øt qu·∫£ */
        .result-box { display: none; background: #e8f5e9; border: 2px solid #4caf50; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: center; }
        .result-score { font-size: 32px; font-weight: bold; color: #2e7d32; margin: 10px 0; }
        
        /* Tr·∫°ng th√°i ƒë√∫ng sai */
        .correct-ans { color: #2e7d32; font-weight: bold; background: #e8f5e9; padding: 5px 10px; border-radius: 4px; display: inline-block; margin-top: 5px;}
        .wrong-ans { color: #c62828; text-decoration: line-through; margin-right: 10px;}
        .feedback { font-size: 0.95em; margin-top: 10px; color: #444; background: #f1f1f1; padding: 10px; border-radius: 5px; display: none; }
        .show-feedback .feedback { display: block; }
    </style>
</head>
<body>

    <div class="header-info">
        <div>
            <h2>Ki·ªÉm tra: Nguy√™n H√†m (90 ph√∫t)</h2>
            <div class="student-form">
                <input type="text" id="hs-name" placeholder="H·ªç v√† t√™n h·ªçc sinh">
                <input type="text" id="hs-class" placeholder="L·ªõp (VD: 12A1)">
            </div>
        </div>
        <div class="timer" id="timer">90:00</div>
    </div>

    <div id="result-area" class="result-box">
        <h3>K·∫æT QU·∫¢ B√ÄI L√ÄM</h3>
        <p>H·ªçc sinh: <span id="res-name" style="font-weight:bold"></span> - L·ªõp: <span id="res-class" style="font-weight:bold"></span></p>
        <div class="result-score" id="score-display">0 / 0</div>
        <p>H√£y k√©o xu·ªëng d∆∞·ªõi ƒë·ªÉ xem chi ti·∫øt ƒë√°p √°n ƒë√∫ng/sai.</p>
    </div>

    <div class="quiz-container" id="quiz-body">
        <p style="text-align:center">ƒêang t·∫£i c√¢u h·ªèi...</p>
    </div>

    <button class="btn-submit" onclick="submitQuiz()" id="btn-submit">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>

<script>
    // --- C·∫§U H√åNH G·ª¨I ƒêI·ªÇM ---
    // üëáüëáüëá D√ÅN LINK GOOGLE SCRIPT C·ª¶A B·∫†N V√ÄO GI·ªÆA D·∫§U NH√ÅY D∆Ø·ªöI ƒê√ÇY üëáüëáüëá
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw9AvPfuJ53SMG-AIdP9SBL6LThFM-r8DRphGwSqRutArucIK5jxf4BxzTHY2SIBJE/exec"; 

    // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI (GI·ªÆ NGUY√äN) ---
    const questions = [
        // PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM (12 C√ÇU)
        { type: 'mcq', q: 'C√¢u 1: H√†m s·ªë $F(x)$ l√† m·ªôt nguy√™n h√†m c·ªßa h√†m s·ªë $f(x)$ tr√™n kho·∫£ng $K$ n·∫øu:', options: ['A. $F\'(x) = -f(x)$', 'B. $f\'(x) = F(x)$', 'C. $F\'(x) = f(x)$', 'D. $F\'(x) = f\'(x)$'], ans: 2 },
        { type: 'mcq', q: 'C√¢u 2: H·ªç t·∫•t c·∫£ c√°c nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = x^3$ l√†:', options: ['A. $3x^2 + C$', 'B. $\\frac{x^4}{4} + C$', 'C. $x^4 + C$', 'D. $\\frac{x^3}{3} + C$'], ans: 1 },
        { type: 'mcq', q: 'C√¢u 3: T√¨m nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = e^x + 1$.', options: ['A. $e^x + x + C$', 'B. $e^x + C$', 'C. $e^x - x + C$', 'D. $xe^x + C$'], ans: 0 },
        { type: 'mcq', q: 'C√¢u 4: H√†m s·ªë n√†o d∆∞·ªõi ƒë√¢y l√† m·ªôt nguy√™n h√†m c·ªßa h√†m s·ªë $y = \\sin x$?', options: ['A. $\\cos x$', 'B. $-\\cos x$', 'C. $\\sin x$', 'D. $-\\sin x$'], ans: 1 },
        { type: 'mcq', q: 'C√¢u 5: H·ªç nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = 3^x$ l√†:', options: ['A. $3^x \\ln 3 + C$', 'B. $\\frac{3^x}{\\ln 3} + C$', 'C. $3^{x+1} + C$', 'D. $\\frac{3^{x+1}}{x+1} + C$'], ans: 1 },
        { type: 'mcq', q: 'C√¢u 6: T√¨m nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = \\frac{1}{x}$ tr√™n kho·∫£ng $(0; +\\infty)$.', options: ['A. $\\ln x + C$', 'B. $-\\frac{1}{x^2} + C$', 'C. $\\ln |x| + C$', 'D. $\\ln(-x) + C$'], ans: 0 },
        { type: 'mcq', q: 'C√¢u 7: Cho $\\int f(x) dx = F(x) + C$. Kh·∫≥ng ƒë·ªãnh n√†o ƒë√∫ng?', options: ['A. $\\int 2f(x) dx = 2F(x) + C$', 'B. $\\int 2f(x) dx = F(x) + C$', 'C. $\\int 2f(x) dx = F(2x) + C$', 'D. Sai h·∫øt'], ans: 0 },
        { type: 'mcq', q: 'C√¢u 8: Bi·∫øt nguy√™n h√†m $F(x)$ c·ªßa $f(x) = 2x$ tho·∫£ m√£n $F(1) = 3$. $F(x)$ l√†:', options: ['A. $x^2 + 3$', 'B. $x^2 + 2$', 'C. $2x^2 + 1$', 'D. $x^2 - 1$'], ans: 1 },
        { type: 'mcq', q: 'C√¢u 9: H·ªç nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = x^2 - 3x + \\frac{1}{x^2}$ l√†:', options: ['A. $\\frac{x^3}{3} - \\frac{3x^2}{2} - \\frac{1}{x} + C$', 'B. $\\frac{x^3}{3} - \\frac{3x^2}{2} + \\frac{1}{x} + C$', 'C. $2x - 3$', 'D. ƒê√°p √°n kh√°c'], ans: 0 },
        { type: 'mcq', q: 'C√¢u 10: $F(x) = 5x^3 + 4x^2 - 7$ l√† nguy√™n h√†m c·ªßa:', options: ['A. $f(x) = ...$', 'B. $f(x) = 15x^2 + 8x$', 'C. $f(x) = 15x^2 + 8x - 7$', 'D. $5x^2 + 4x$'], ans: 1 },
        { type: 'mcq', q: 'C√¢u 11: Kh·∫≥ng ƒë·ªãnh n√†o SAI?', options: ['A. $\\int 0 dx = C$', 'B. $\\int dx = x + C$', 'C. $\\int x^n dx = \\frac{x^{n+1}}{n+1} + C$ v·ªõi m·ªçi $n$', 'D. $\\int k dx = kx + C$'], ans: 2 },
        { type: 'mcq', q: 'C√¢u 12: T√¨m h·ªç nguy√™n h√†m c·ªßa $f(x) = \\frac{1}{\\cos^2 x}$.', options: ['A. $\\tan x + C$', 'B. $-\\tan x + C$', 'C. $\\cot x + C$', 'D. $-\\cot x + C$'], ans: 0 },

        // PH·∫¶N 2: ƒê√öNG SAI (4 C√ÇU)
        { type: 'tf', q: 'C√¢u 13: Cho $f(x) = 4x^3 - 2x + 1$. X√©t c√°c kh·∫≥ng ƒë·ªãnh:', items: [
            {sub: 'a) $F(x) = x^4 - x^2 + x$ l√† m·ªôt nguy√™n h√†m.', ans: 'T'},
            {sub: 'b) $G(x) = x^4 - x^2 + x + 2024$ c≈©ng l√† nguy√™n h√†m.', ans: 'T'},
            {sub: 'c) M·ªçi nguy√™n h√†m ƒë·ªÅu c√≥ d·∫°ng $x^4 - x^2 + x + C$.', ans: 'T'},
            {sub: 'd) T·ªìn t·∫°i nguy√™n h√†m $H(x)$ sao cho $H(1) = 5$.', ans: 'T'}
        ]},
        { type: 'tf', q: 'C√¢u 14: V·∫≠t l√≠: $v(t) = 6t - 4$.', items: [
            {sub: 'a) Gia t·ªëc $a(t) = 6$.', ans: 'T'},
            {sub: 'b) Qu√£ng ƒë∆∞·ªùng l√† nguy√™n h√†m v·∫≠n t·ªëc.', ans: 'T'},
            {sub: 'c) C√¥ng th·ª©c qu√£ng ƒë∆∞·ªùng l√† $s(t) = 3t^2 - 4t$.', ans: 'F'},
            {sub: 'd) T·∫°i $t=0, s=10$ th√¨ $s(2) = 14$.', ans: 'T'}
        ]},
        { type: 'tf', q: 'C√¢u 15: Cho $f(x) = e^x$ v√† $g(x) = x^2$.', items: [
            {sub: 'a) T·ªïng nguy√™n h√†m b·∫±ng nguy√™n h√†m t·ªïng.', ans: 'T'},
            {sub: 'b) T√≠ch nguy√™n h√†m b·∫±ng nguy√™n h√†m t√≠ch.', ans: 'F'},
            {sub: 'c) Nguy√™n h√†m $2f(x)$ l√† $2e^x$.', ans: 'T'},
            {sub: 'd) $\\int \\frac{g(x)}{x} dx = \\frac{x^2}{2} + C$.', ans: 'T'}
        ]},
        { type: 'tf', q: 'C√¢u 16: $f(x) = \\frac{1}{\\sin^2 x}$.', items: [
            {sub: 'a) X√°c ƒë·ªãnh v·ªõi m·ªçi R.', ans: 'F'},
            {sub: 'b) Nguy√™n h√†m l√† $-\\cot x + C$.', ans: 'T'},
            {sub: 'c) ƒê·∫°o h√†m $\\cot x$ l√† $f(x)$.', ans: 'F'},
            {sub: 'd) $F(\\pi/4) = 1$ v·ªõi $F(x)=-\\cot x+2$.', ans: 'T'}
        ]},

        // PH·∫¶N 3: TR·∫¢ L·ªúI NG·∫ÆN (6 C√ÇU)
        { type: 'short', q: 'C√¢u 17: T√¨m $C$ bi·∫øt $F(x)$ c·ªßa $4x^3+1$ qua $M(1;5)$.', ans: '3' },
        { type: 'short', q: 'C√¢u 18: Chi ph√≠ $MC(x)=6x+50$, ph√≠ c·ªë ƒë·ªãnh 1000. T√≠nh chi ph√≠ t·∫°i $x=10$.', ans: '1800' },
        { type: 'short', q: 'C√¢u 19: Vi khu·∫©n $N\'(t)=100e^t$, ban ƒë·∫ßu 200 con. ƒê·∫°t 1300 con sau bao nhi√™u ph√∫t? (L√†m tr√≤n ƒë∆°n v·ªã)', ans: '2' }, 
        { type: 'short', q: 'C√¢u 20: T√≠nh $f(\\pi)$ bi·∫øt $f\'(x)=3-5\\sin x, f(0)=10$. (L√†m tr√≤n 2 s·ªë th·∫≠p ph√¢n)', ans: '9.42' },
        { type: 'short', q: 'C√¢u 21: Th·ªùi gian ƒë·∫°n l√™n cao c·ª±c ƒë·∫°i (gi√¢y)? ($v_0=98, g=-9.8$)', ans: '10' },
        { type: 'short', q: 'C√¢u 22: T√≠nh $F(e+1)$ bi·∫øt $F(x)$ l√† nguy√™n h√†m $\\frac{1}{x-1}, F(2)=1$.', ans: '2' }
    ];

    // --- LOGIC CH∆Ø∆†NG TR√åNH ---
    const quizBody = document.getElementById('quiz-body');
    let timerDuration = 90 * 60; 

    function initQuiz() {
        let html = '';
        questions.forEach((q, index) => {
            html += `<div class="question-block" id="q-${index}">`;
            
            if(q.type === 'mcq') {
                html += `<div class="question-title">${q.q}</div><div class="options">`;
                q.options.forEach((opt, i) => {
                    html += `<label><input type="radio" name="q${index}" value="${i}"> ${opt}</label>`;
                });
                html += `</div><div class="feedback" id="fb-${index}">ƒê√°p √°n ƒë√∫ng: ${q.options[q.ans]}</div>`;
            } else if (q.type === 'tf') {
                html += `<div class="question-title">${q.q}</div>`;
                html += `<table class="tf-table"><tr><th>M·ªánh ƒë·ªÅ</th><th>ƒê</th><th>S</th></tr>`;
                q.items.forEach((item, subIndex) => {
                    html += `<tr><td>${item.sub}</td><td class="center"><input type="radio" name="q${index}_${subIndex}" value="T"></td><td class="center"><input type="radio" name="q${index}_${subIndex}" value="F"></td></tr>`;
                });
                html += `</table><div class="feedback" id="fb-${index}">ƒê√°p √°n: ${q.items.map(i => i.ans).join(', ')}</div>`;
            } else if (q.type === 'short') {
                html += `<div class="question-title">${q.q}</div>`;
                html += `<input type="text" id="in-${index}" placeholder="Nh·∫≠p k·∫øt qu·∫£...">`;
                html += `<div class="feedback" id="fb-${index}">ƒê√°p √°n ƒë√∫ng: ${q.ans}</div>`;
            }
            html += `</div>`;
        });
        
        quizBody.innerHTML = html;
        if(window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();
        startTimer();
    }

    function startTimer() {
        const display = document.getElementById('timer');
        const timerInterval = setInterval(() => {
            let minutes = parseInt(timerDuration / 60, 10);
            let seconds = parseInt(timerDuration % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            display.textContent = minutes + ":" + seconds;

            if (--timerDuration < 0) {
                clearInterval(timerInterval);
                alert("H·∫øt gi·ªù l√†m b√†i!");
                submitQuiz();
            }
        }, 1000);
        window.quizTimer = timerInterval; 
    }

    function submitQuiz() {
        // Ki·ªÉm tra xem ƒë√£ nh·∫≠p t√™n ch∆∞a
        const name = document.getElementById('hs-name').value;
        const className = document.getElementById('hs-class').value;
        if(!name || !className) {
            alert("Em vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç t√™n v√† L·ªõp tr∆∞·ªõc khi n·ªôp b√†i!");
            return;
        }

        clearInterval(window.quizTimer); 
        const btn = document.getElementById('btn-submit');
        btn.disabled = true;
        btn.innerText = "ƒêANG G·ª¨I ƒêI·ªÇM..."; // Th√¥ng b√°o ƒëang g·ª≠i

        let score = 0;
        let totalPoints = 0;

        questions.forEach((q, index) => {
            const block = document.getElementById(`q-${index}`);
            block.classList.add('show-feedback');
            
            if(q.type === 'mcq') {
                totalPoints++;
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                if(selected && parseInt(selected.value) === q.ans) {
                    score++;
                    block.innerHTML += `<div class="correct-ans">ƒê√∫ng (+1ƒë)</div>`;
                } else { block.innerHTML += `<div class="wrong-ans">Sai</div>`; }
            } else if(q.type === 'tf') {
                q.items.forEach((item, subIndex) => {
                    totalPoints += 0.25;
                    const selected = document.querySelector(`input[name="q${index}_${subIndex}"]:checked`);
                    if(selected && selected.value === item.ans) score += 0.25;
                });
            } else if(q.type === 'short') {
                totalPoints++;
                const input = document.getElementById(`in-${index}`).value.trim();
                if(input === q.ans || input.replace(',', '.') === q.ans) {
                    score++;
                    block.innerHTML += `<div class="correct-ans">ƒê√∫ng (+1ƒë)</div>`;
                } else { block.innerHTML += `<div class="wrong-ans">Sai</div>`; }
            }
        });

        // HI·ªÇN TH·ªä K·∫æT QU·∫¢ CHO H·ªåC SINH
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('res-name').innerText = name;
        document.getElementById('res-class').innerText = className;
        document.getElementById('score-display').innerText = `${score} / ${totalPoints}`;
        
        // G·ª¨I ƒêI·ªÇM V·ªÄ GOOGLE SHEET (·∫®N)
        if(GOOGLE_SCRIPT_URL.startsWith('http')) {
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Quan tr·ªçng: ch·∫ø ƒë·ªô no-cors ƒë·ªÉ g·ª≠i ƒë∆∞·ª£c t·ª´ GitHub
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name, class: className, score: score + "/" + totalPoints })
            }).then(() => {
                btn.innerText = "ƒê√É N·ªòP B√ÄI TH√ÄNH C√îNG";
            }).catch(err => {
                console.error('L·ªói g·ª≠i ƒëi·ªÉm:', err);
                btn.innerText = "L·ªñI G·ª¨I ƒêI·ªÇM (H√£y ch·ª•p m√†n h√¨nh)";
            });
        } else {
             btn.innerText = "ƒê√É N·ªòP B√ÄI (Ch∆∞a k·∫øt n·ªëi Sheet)";
        }

        document.getElementById('btn-submit').style.display = 'none'; // ·∫®n n√∫t n·ªôp
        window.scrollTo(0, 0);
        if(window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();
    }

    initQuiz();
</script>

</body>
</html>
