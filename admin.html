<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• So·∫°n ƒê·ªÅ Thi (v4.0 Lite)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <style>
        body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        h1 { color: #00796b; text-align: center; border-bottom: 2px solid #00796b; padding-bottom: 10px; }
        h3 { background: #e0f2f1; padding: 10px; border-left: 5px solid #00796b; margin-top: 30px; }

        .form-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        textarea { height: 70px; font-family: monospace; }

        /* THANH C√îNG C·ª§ */
        .toolbar { position: sticky; top: 0; background: #fff; padding: 10px 0; border-bottom: 1px solid #ddd; z-index: 100; display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 10px 20px; cursor: pointer; font-weight: bold; color: white; border: none; border-radius: 4px; font-size: 14px; }
        .btn-mcq { background: #2196F3; }
        .btn-tf { background: #FF9800; }
        .btn-short { background: #9C27B0; }
        .btn-save { background: #4CAF50; margin-left: auto; }
        .btn-del { background: #F44336; padding: 5px 10px; margin-left: 10px; }

        /* KHUNG C√ÇU H·ªéI */
        .q-box { border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; background: #fafafa; border-radius: 5px; }
        .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: bold; }
        .badge { padding: 3px 8px; color: white; border-radius: 3px; font-size: 12px; margin-right: 5px; }
        
        /* CHECKBOX */
        .opt-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        input[type="radio"] { width: 20px; height: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>C√îNG C·ª§ SO·∫†N ƒê·ªÄ THI</h1>

    <h3>1. C·∫•u H√¨nh ƒê·ªÅ Thi</h3>
    <div style="display:flex; gap:15px">
        <div style="flex:1">
            <label>M√£ ƒê·ªÅ (T√™n file)</label>
            <input type="text" id="exam-id" placeholder="V√≠ d·ª•: de-02">
        </div>
        <div style="flex:2">
            <label>Ti√™u ƒê·ªÅ (Hi·ªÉn th·ªã cho HS)</label>
            <input type="text" id="exam-title" placeholder="Ki·ªÉm tra 1 ti·∫øt...">
        </div>
        <div style="flex:1">
            <label>Th·ªùi gian (ph√∫t)</label>
            <input type="number" id="exam-time" value="45">
        </div>
    </div>
    
    <div class="form-group" style="margin-top:10px">
        <label>M√¥ t·∫£ ƒë·ªÅ thi</label>
        <input type="text" id="exam-desc" placeholder="N·ªôi dung, ph·∫°m vi ki·∫øn th·ª©c...">
    </div>

    <div style="background:#fff3e0; padding:15px; border-radius:5px; margin-top:15px">
        <label>T·∫°o M·∫≠t Kh·∫©u (N·∫øu c·∫ßn)</label>
        <div style="display:flex; gap:10px">
            <input type="text" id="raw-pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ch·ªØ th∆∞·ªùng..." oninput="createPass()">
            <input type="text" id="hashed-pass" placeholder="M√£ h√≥a MD5 s·∫Ω hi·ªán ·ªü ƒë√¢y..." readonly style="background:#eee; color:#666">
        </div>
    </div>

    <h3>2. C·∫•u H√¨nh ƒêi·ªÉm S·ªë</h3>
    <div style="display:flex; gap:15px">
        <div style="flex:1"><label>ƒêi·ªÉm Tr·∫Øc nghi·ªám (1 c√¢u)</label><input type="number" id="score-mcq" value="0.25"></div>
        <div style="flex:1"><label>ƒêi·ªÉm ƒê√∫ng/Sai (T·ªëi ƒëa)</label><input type="number" id="score-tf" value="1.0"></div>
        <div style="flex:1"><label>ƒêi·ªÉm Tr·∫£ l·ªùi ng·∫Øn (1 c√¢u)</label><input type="number" id="score-short" value="0.5"></div>
    </div>

    <h3>3. So·∫°n C√¢u H·ªèi</h3>
    <div class="toolbar">
        <button class="btn-mcq" onclick="addQ('mcq')">‚ûï Tr·∫Øc Nghi·ªám</button>
        <button class="btn-tf" onclick="addQ('tf')">‚ûï ƒê√∫ng/Sai</button>
        <button class="btn-short" onclick="addQ('short')">‚ûï Tr·∫£ L·ªùi Ng·∫Øn</button>
        <button class="btn-save" onclick="exportFile()">üíæ T·∫¢I FILE CODE (.JS)</button>
    </div>

    <div id="q-container" style="margin-top:20px"></div>
</div>

<script>
    // Ki·ªÉm tra th∆∞ vi·ªán m√£ h√≥a
    window.onload = function() {
        if(typeof CryptoJS === 'undefined') {
            alert("C·∫£nh b√°o: M√°y t√≠nh ch∆∞a k·∫øt n·ªëi m·∫°ng ho·∫∑c kh√¥ng t·∫£i ƒë∆∞·ª£c th∆∞ vi·ªán m√£ h√≥a!\nCh·ª©c nƒÉng t·∫°o m·∫≠t kh·∫©u c√≥ th·ªÉ kh√¥ng ho·∫°t ƒë·ªông.");
        }
    }

    let questions = [];

    function createPass() {
        let p = document.getElementById('raw-pass').value.trim();
        if(p && typeof CryptoJS !== 'undefined') {
            document.getElementById('hashed-pass').value = CryptoJS.MD5(p).toString();
        } else {
            document.getElementById('hashed-pass').value = "";
        }
    }

    function addQ(type) {
        let id = Date.now();
        questions.push({ id: id, type: type });
        render();
        // Cu·ªôn xu·ªëng c√¢u h·ªèi m·ªõi
        setTimeout(() => document.getElementById('q-'+id).scrollIntoView({behavior: "smooth"}), 100);
    }

    function removeQ(id) {
        if(confirm("X√≥a c√¢u n√†y?")) {
            questions = questions.filter(q => q.id !== id);
            render();
        }
    }

    function render() {
        let html = '';
        questions.forEach((q, idx) => {
            let badgeColor = q.type=='mcq'?'#2196F3':(q.type=='tf'?'#FF9800':'#9C27B0');
            let typeName = q.type=='mcq'?'Tr·∫Øc Nghi·ªám':(q.type=='tf'?'ƒê√∫ng/Sai':'Tr·∫£ L·ªùi Ng·∫Øn');
            
            html += `<div class="q-box" id="q-${q.id}">
                <div class="q-header">
                    <span style="color:${badgeColor}">‚óè C√¢u ${idx+1} [${typeName}]</span>
                    <button class="btn-del" onclick="removeQ(${q.id})">X√≥a</button>
                </div>
                <div class="form-group">
                    <textarea id="content-${q.id}" placeholder="Nh·∫≠p ƒë·ªÅ b√†i (H·ªó tr·ª£ LaTeX $...$)"></textarea>
                </div>`;

            // GIAO DI·ªÜN T√ôY BI·∫æN THEO LO·∫†I
            if(q.type === 'mcq') {
                html += `<div style="background:#e3f2fd; padding:10px; border-radius:4px; margin-bottom:10px">
                    <label>Nh·∫≠p 4 ƒë√°p √°n v√† t√≠ch v√†o ƒë√°p √°n ƒë√∫ng:</label>`;
                ['A','B','C','D'].forEach((lbl, i) => {
                    html += `<div class="opt-row">
                        <input type="radio" name="ans-${q.id}" value="${i}">
                        <b>${lbl}.</b>
                        <input type="text" id="opt-${q.id}-${i}" placeholder="N·ªôi dung ƒë√°p √°n ${lbl}...">
                    </div>`;
                });
                html += `</div>`;
            } else if(q.type === 'tf') {
                html += `<div style="background:#fff3e0; padding:10px; border-radius:4px; margin-bottom:10px">
                    <label>Nh·∫≠p 4 m·ªánh ƒë·ªÅ v√† ch·ªçn ƒê√∫ng (T) / Sai (F):</label>
                    <table width="100%"><tr><th>N·ªôi dung</th><th width="50">ƒê</th><th width="50">S</th></tr>`;
                [0,1,2,3].forEach(i => {
                    html += `<tr>
                        <td><input type="text" id="tf-sub-${q.id}-${i}" placeholder="M·ªánh ƒë·ªÅ ${i+1}..."></td>
                        <td align="center"><input type="radio" name="tf-${q.id}-${i}" value="T"></td>
                        <td align="center"><input type="radio" name="tf-${q.id}-${i}" value="F" checked></td>
                    </tr>`;
                });
                html += `</table></div>`;
            } else {
                html += `<div style="background:#f3e5f5; padding:10px; border-radius:4px; margin-bottom:10px">
                    <label>ƒê√°p √°n ƒë√∫ng (S·ªë ho·∫∑c Ch·ªØ):</label>
                    <input type="text" id="short-${q.id}" placeholder="V√≠ d·ª•: 2025">
                </div>`;
            }

            html += `<div class="form-group">
                <textarea id="explain-${q.id}" style="height:50px" placeholder="Nh·∫≠p l·ªùi gi·∫£i chi ti·∫øt..."></textarea>
            </div></div>`;
        });
        document.getElementById('q-container').innerHTML = html;
    }

    function exportFile() {
        // Thu th·∫≠p d·ªØ li·ªáu
        let examId = document.getElementById('exam-id').value.trim() || 'de-moi';
        if(examId.endsWith('.js')) examId = examId.replace('.js','');

        let data = {
            title: document.getElementById('exam-title').value,
            description: document.getElementById('exam-desc').value,
            time: parseInt(document.getElementById('exam-time').value) || 45,
            password: document.getElementById('hashed-pass').value,
            scores: {
                mcq: parseFloat(document.getElementById('score-mcq').value),
                tf: parseFloat(document.getElementById('score-tf').value),
                short: parseFloat(document.getElementById('score-short').value)
            },
            questions: []
        };

        // Duy·ªát t·ª´ng c√¢u h·ªèi ƒë·ªÉ l·∫•y n·ªôi dung
        questions.forEach(q => {
            let qObj = {
                type: q.type,
                q: document.getElementById(`content-${q.id}`).value,
                explain: document.getElementById(`explain-${q.id}`).value
            };

            if(q.type === 'mcq') {
                qObj.options = [];
                for(let i=0; i<4; i++) qObj.options.push(document.getElementById(`opt-${q.id}-${i}`).value);
                let checked = document.querySelector(`input[name="ans-${q.id}"]:checked`);
                qObj.ans = checked ? parseInt(checked.value) : 0;
            } 
            else if(q.type === 'tf') {
                qObj.items = [];
                for(let i=0; i<4; i++) {
                    let sub = document.getElementById(`tf-sub-${q.id}-${i}`).value;
                    let ans = document.querySelector(`input[name="tf-${q.id}-${i}"]:checked`).value;
                    qObj.items.push({sub: sub, ans: ans});
                }
            } 
            else {
                qObj.ans = document.getElementById(`short-${q.id}`).value;
            }
            data.questions.push(qObj);
        });

        // T·∫†O FILE V√Ä T·∫¢I V·ªÄ
        let content = `window.EXAM_DATA = ${JSON.stringify(data, null, 4)};`;
        let blob = new Blob([content], { type: "text/javascript;charset=utf-8" });
        let url = URL.createObjectURL(blob);
        let a = document.createElement("a");
        a.href = url;
        a.download = `${examId}.js`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>
